dependencies:
  pre:
    - curl https://yarnpkg.com/install.sh | bash
  override:
    - case $CIRCLE_NODE_INDEX in 0) make setup ;; 1) nvm install 6 && nvm exec 6 make setup ;; 2) nvm install 7 && nvm exec 7 make setup ;; esac:
        parallel: true
  cache_directories:
      - ~/.cache/yarn

machine:
  node:
    version: 4
  environment:
      PATH: "${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"

test:
  override:
    - make lint
    - case $CIRCLE_NODE_INDEX in 0) make test ;; 1) nvm exec 6 make test ;; 2) nvm exec 7 make test ;; esac:
        parallel: true
